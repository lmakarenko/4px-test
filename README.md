<p align="center"><img src="https://res.cloudinary.com/dtfbvvkyp/image/upload/v1566331377/laravel-logolockup-cmyk-red.svg" width="400"></p>

<p align="center">
<a href="https://travis-ci.org/laravel/framework"><img src="https://travis-ci.org/laravel/framework.svg" alt="Build Status"></a>
<a href="https://packagist.org/packages/laravel/framework"><img src="https://poser.pugx.org/laravel/framework/d/total.svg" alt="Total Downloads"></a>
<a href="https://packagist.org/packages/laravel/framework"><img src="https://poser.pugx.org/laravel/framework/v/stable.svg" alt="Latest Stable Version"></a>
<a href="https://packagist.org/packages/laravel/framework"><img src="https://poser.pugx.org/laravel/framework/license.svg" alt="License"></a>
</p>

## Ручная настройка окружения для приложения

- Клонировать репозиторий: git clone https://github.com/lmakarenko/4px-test
- Перейти в папку приложения: cd 4px-test
- Запуск контейнеров докера: docker-compose up -d
- Зайти в контейнер php-fpm: docker-compose exec php-fpm bash
- Выполнить в контейнере php-fpm установку пакетов через composer: composer install
- Запустить миграции и посев: php artisan migrate:fresh --seed

## Постановка задачи

Создать отдельный проект, демонстрирующий опыт работы программиста с Laravel.

#### Страницы:
- Авторизация (пример)
- Список отделов (пример)
- Страница добавления / редактирования отдела (пример)
- Список пользователей (пример)
- Страница добавления / редактирования пользователя (пример)

#### Состав задачи:
- Авторизация для всех пользователей
- Таблица раздела «Пользователи» создается миграцией из поставки
- Тестовая учетная запись для проверки (смотри Требования) создается посевом (seeds), 15 дополнительных пользователей создаются при помощи фабрики (factory)
- Таблица раздела «Отделы» создается миграцией, поля: name - название отдела, description - описание отдела, logo - логотип (изображение) для отдела
- Данные в таблицу «Отделы» необходимо создать посевом (seeds) или при помощи фабрики (factory), 15 записей
- Пользователи должны относиться к отделам, каждый пользователь может быть в нескольких отделах. Связь должна быть реализована через внешний ключ (foreign)
- Контроллер реализующий CRUD (Create, Read, Update, Delete) для раздела «Отделы» и «Пользователи», для добавления и редактирования записей необходимо использовать валидацию
- Логотипы отделов хранить в папке storage/app/logo, сделать данную папку доступной из папки public
- Постраничная навигация, с выводом 4-10 последних записей.

### Требования:
- PHPDoc обязателен для всех методов, с указанием всех входных и выходных параметров. Каждый метод должен иметь четкое, краткое и понятное описание того что он делает.
- Соблюдение PSR (до 4 версии включительно)
- Код необходимо выложить на удаленный git-репозиторий (любой) или прислать в архиве (zip)
- Необходимо создать учетную запись для проверки работы со следующими данными: Логин: admin@test.loc, пароль: password

## Решение

#### Структура программного комплекса
Создаваемый программный комплекс имеет трехуровневую архитектуру:
- слой клиента (браузер, frontend)
- слой логики (серверное php-приложение, backend)
- слой данных (MySQL БД, backend)

###### Структура слоя клиента (frontend)
Слой клиента представляет собой тонкий клиент, поэтому приложение содержит множество страниц, содержимое которых формируется на стороне сервера, и минимум логики на стороне frontend (НЕ является SPA).

###### Структура слоя логики (php-приложение)
В слое логики, к имеющейся MVC-архитектуре приложения добавлен дополнительный уровень (сервисный), решающий проблему "толстого контроллера", реализующий работу с сущностями, хранящимися в БД.

###### Структура слоя данных (БД)
Таблицы пользователей (user) и отделов (section) связаны отношением многие-ко-многим через ассоциативную таблицу (pivot-таблицу section_user).

#### Репозитории
Данный слой реализован в виде паттерна репозиторий. Всего создано 2 репозитория, для работы с пользователями и отделами. Для каждого типа репозитория создан интерфейс, по котормоу репозиторий будет связан с другими компонентами приложения.

Связь через интерфейс используется для уменьшения связности (Low Coupling), и возможности создавать новые реализации, без необходимости изменения кода, где эти реализации используются (Dependency Inversion). 

Репозиторий пользователей:
- интерфейс - App\Repositories\User\UserContract
- реализация - App\Repositories\User\UserRepository

Репозиторий отделов:
- интерфейс - App\Repositories\Section\SectionContract
- реализация - App\Repositories\Section\SectionRepository

В обоих репозиториях, работа с сущностями, хранящимися в БД, реализована с использованием  ORM Eloquent.

#### Сервисы
Кроме использования репозиториев, также в отдельные модули (сервисы) вынесен следующий функционал:
- работа с файловым хранилищем логотипов отделов
- логирование ошибок

###### LogoManager - менеджер логотипов
Для работы с файловым хранилищем логотипов отделов создан сервис LogoManager:
 
- интерфейс - App\Services\LogoManager\LogoManagerContract
- реализация - App\Services\LogoManager\LogoManager

LogoManager реализует сохранение, удаление и пропорциональное изменение размеров логотипа.

###### ErrorLogger - логгер ошибок
Для логирования ошибок приложения создан сервис ErrorLogger: 

- интерфейс - App\Services\Loggers\ErrorLogger\ErrorLoggerContract
- реализация - App\Services\Loggers\ErrorLogger\ErrorLogger

ErrorLogger реализует логирование ошибок (только уровень error), используя встроенный логгер фреймворка (Log).
Логирование может быть осуществлено как по входной строке с описанием ошибки, так и по обьекту исключения (\Exception).
По-умолчанию, логирование ошибок сохраняется в /storage/logs/app-errors.log

#### Frontend приложения

Frontend составляющая приложения реализована с использованием представлений (views):
- шаблонов представлений (/resources/views/layouts)
- конкретных представлений (/resources/views)

Приложение не является SPA (Single Page Application), поэтому рендеринг web-страниц происходит на стороне сервера, на стороне браузера содержится минимум логики.

** Планируется доработка приложение - использование на слое клиента JavaScript фреймворка Vue.js, и построение SPA-приложения.

Используется функционал фрейморка Laravel для локализации - русские названия английских элементов web-страниц вынесены в json-справочник (/resources/lang/ru.js).
